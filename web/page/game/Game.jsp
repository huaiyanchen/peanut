<%--
  Created by IntelliJ IDEA.
  User: Administrator
  Date: 2021/5/25
  Time: 17:59
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>ü•úüöá</title>
    <style>
        .el-main {
            height: calc(100vh - 70px);
        }
    </style>

    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/element-ui/2.15.1/index.min.js"></script>
</head>
<body>
<div id="vue2">
    <el-container>
        <el-main>
            <el-card class="box-card">

                <el-form :inline="true" ref="myForm" class="demo-form-inline">
                    <el-form-item>
                        <el-button type="success" plain @click="addDialog = true">Ê∑ªÂä†</el-button>
                    </el-form-item>
                </el-form>

                <el-table :data="gameList" style="width: 100%;height: 80%" stripe border>
                    <el-table-column prop="gid" label="ÁºñÂè∑" width="150"></el-table-column>
                    <el-table-column prop="name" label="Ê∏∏ÊàèÂêçÁß∞" width="150"></el-table-column>
                    <el-table-column prop="title" label="Ê∏∏ÊàèÊ†áÈ¢ò" width="200"></el-table-column>
                    <el-table-column prop="downLoadCount" label="‰∏ãËΩΩÈáè" width="100"></el-table-column>
                    <el-table-column prop="size" label="Â§ßÂ∞è(M)" width="100"></el-table-column>
                    <el-table-column prop="state" label="Áä∂ÊÄÅ" width="150">
                        <template slot-scope="scope">
                            {{scope.row.state==3?"‰ΩìÈ™åÊúç":""}}
                            {{scope.row.state==2?"Ê≠£ÂºèÊúç":""}}
                            {{scope.row.state==1?"Êä¢ÂÖàÊúç":""}}
                            {{scope.row.state==0?"ÊµãËØïÊúç":""}}
                        </template>
                    </el-table-column>

                    <el-table-column prop="typeId" label="ÂàÜÁ±ª" width="150">
                        <template slot-scope="scope">
                            {{scope.row.typeId==1?"‰ºëÈó≤ÁõäÊô∫":""}}
                            {{scope.row.typeId==2?"ÁΩëÁªúÊ∏∏Êàè":""}}
                            {{scope.row.typeId==3?"‰ΩìËÇ≤Á´ûÊäÄ":""}}
                            {{scope.row.typeId==4?"Ê£ãÁâå‰∏≠ÂøÉ":""}}
                        </template>
                    </el-table-column>

                    <el-table-column prop="platform" label="Âπ≥Âè∞Á±ªÂûã" width="150"></el-table-column>
                    <el-table-column prop="rank" label="Êé®ËçêÁ±ªÂûã" width="150">
                        <template slot-scope="scope">
                            {{scope.row.rank==3?"ÊôÆÈÄö":""}}
                            {{scope.row.rank==2?"ÊúÄÊñ∞":""}}
                            {{scope.row.rank==1?"Á≤æÈÄâ":""}}
                            {{scope.row.rank==0?"È¶ñÈ°µÊé®Ëçê":""}}
                        </template>
                    </el-table-column>

                    <el-table-column label="Êìç‰Ωú" align="center" min-width="50">
                        <template slot-scope="scope">
                            <el-button type="primary" round @click="modifyGame(scope.$index)">‰øÆÊîπ</el-button>

                            <el-popconfirm
                                    confirm-button-text='Â•ΩÁöÑ'
                                    cancel-button-text='‰∏çÁî®‰∫Ü'
                                    icon="el-icon-info"
                                    icon-color="red"
                                    title="ËøôÊòØ‰∏ÄÊÆµÂÜÖÂÆπÁ°ÆÂÆöÂà†Èô§ÂêóÔºü"
                                    <%--@click="deleteGame(scope.row.gid)"--%>
                                    @confirm ="deleteGame(scope.row.gid)"
                            >
                                <el-button type="danger" round slot="reference"  >Âà†Èô§</el-button>
                            </el-popconfirm>

                        </template>
                    </el-table-column>
                </el-table>

                <!--
                    layoutÔºösizes->ÊØèÈ°µÊòæÁ§∫Âá†Êù°Êï∞ÊçÆ  prev->‰∏ä‰∏ÄÈ°µ  pager->È°µÁ†Å  next->‰∏ã‰∏ÄÈ°µ  jumper->Ë∑≥ËΩ¨Âà∞Êüê‰∏ÄÈ°µ
                 -->
                <el-pagination background layout="sizes,prev, pager, next, jumper"
                               @size-change="sizeChange" @current-change="currentChange" :page-sizes="[3, 6, 9]"
                               :total="pageInfo.total"
                               :page-size="pageInfo.pageSize" :current-page="pageInfo.currentpage">
                </el-pagination>
            </el-card>

            <%--      =========================    ÁºñËæë   ============================================    --%>
            <el-dialog style="width: 1000px;" title="Ê∑ªÂä†Ê∏∏Êàè" :visible.sync="addDialog">
                <el-form :model="addGame">
                    <el-form-item label="Ê∏∏ÊàèÂêçÁß∞" :label-width="formLabelWidth">
                        <el-input v-model="addGame.name" autocomplete="off"></el-input>
                    </el-form-item>
                    <el-form-item label="Ê†áÈ¢ò" :label-width="formLabelWidth">
                        <el-input v-model="addGame.title" autocomplete="off"></el-input>
                    </el-form-item>
                    <el-form-item label="Â§ßÂ∞è" :label-width="formLabelWidth">
                        <el-input v-model="addGame.size" autocomplete="off"></el-input>
                    </el-form-item>

                    <el-form-item label="‰∏äÊû∂Áä∂ÊÄÅ" :label-width="formLabelWidth">
                        <el-select v-model="addGame.state" placeholder="ËØ∑ÈÄâÊã©‰∏äÁ∫øÊúçÁ±ªÂûã">
                            <el-option label="ÊµãËØïÊúç" value="0"></el-option>
                            <el-option label="Êä¢ÂÖàÊúç" value="1"></el-option>
                            <el-option label="Ê≠£ÂºèÊúç" value="2"></el-option>
                            <el-option label="‰ΩìÈ™åÊúç" value="3"></el-option>
                        </el-select>
                    </el-form-item>

                    <el-form-item label="Ê∏∏ÊàèÁ±ªÂûã" :label-width="formLabelWidth">
                        <el-select v-model="addGame.typeId" placeholder="ËØ∑ÈÄâÊã©‰∏äÁ∫øÊúçÁ±ªÂûã">
                            <el-option label="‰ºëÈó≤ÁõäÊô∫" value="1"></el-option>
                            <el-option label="ÁΩëÁªúÊ∏∏Êàè" value="2"></el-option>
                            <el-option label="‰ΩìËÇ≤Á´ûÊäÄ" value="3"></el-option>
                            <el-option label="Ê£ãÁâå‰∏≠ÂøÉ" value="4"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="‰∏äÁ∫øÂπ≥Âè∞" :label-width="formLabelWidth">
                        <el-select v-model="addGame.platform" placeholder="ËØ∑ÈÄâÊã©Ê¥ªÂä®Âå∫Âüü">
                            <el-option label="ÂÆâÂçì" value="android"></el-option>
                            <el-option label="IOS" value="ios"></el-option>
                            <el-option label="all" value="all"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="Êé®ËçêÁ±ªÂûã" :label-width="formLabelWidth">
                        <el-select v-model="addGame.rank" placeholder="ËØ∑ÈÄâÊã©Ê¥ªÂä®Âå∫Âüü">
                            <el-option label="È¶ñÈ°µÊé®Ëçê" value="0"></el-option>
                            <el-option label="Á≤æÈÄâ" value="1"></el-option>
                            <el-option label="ÊúÄÊñ∞" value="2"></el-option>
                            <el-option label="ÊôÆÈÄö" value="3"></el-option>
                        </el-select>
                    </el-form-item>
                </el-form>
                <div slot="footer" class="dialog-footer">
                    <el-button @click="addDialog = false">Âèñ Ê∂à</el-button>
                    <el-button type="primary" @click="saveGame">Á°Æ ÂÆö</el-button>
                </div>
            </el-dialog>

            <%--+============================ ‰øÆÊîπ +============================--%>
            <el-dialog style="width: 1000px;" title="‰øÆÊîπÊ∏∏Êàè" :visible.sync="updateDialog">
                <el-form :model="updataGame">
                    <el-form-item label="Ê∏∏ÊàèÂêçÁß∞" :label-width="formLabelWidth">
                        <el-input v-model="updataGame.name" autocomplete="off"></el-input>
                    </el-form-item>
                    <el-form-item label="Ê†áÈ¢ò" :label-width="formLabelWidth">
                        <el-input v-model="updataGame.title" autocomplete="off"></el-input>
                    </el-form-item>
                    <el-form-item label="Â§ßÂ∞è" :label-width="formLabelWidth">
                        <el-input v-model="updataGame.size" autocomplete="off"></el-input>
                    </el-form-item>
                    <el-form-item label="‰∏äÊû∂Áä∂ÊÄÅ" :label-width="formLabelWidth">
                        <el-select v-model="updataGame.state" placeholder="ËØ∑ÈÄâÊã©‰∏äÁ∫øÊúçÁ±ªÂûã">
                            <el-option label="ÊµãËØïÊúç" value="0"></el-option>
                            <el-option label="Êä¢ÂÖàÊúç" value="1"></el-option>
                            <el-option label="Ê≠£ÂºèÊúç" value="2"></el-option>
                            <el-option label="‰ΩìÈ™åÊúç" value="3"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="Ê∏∏ÊàèÁ±ªÂûã" :label-width="formLabelWidth">
                        <el-select v-model="updataGame.typeId" placeholder="ËØ∑ÈÄâÊã©‰∏äÁ∫øÊúçÁ±ªÂûã">
                            <el-option label="‰ºëÈó≤ÁõäÊô∫" value="1"></el-option>
                            <el-option label="ÁΩëÁªúÊ∏∏Êàè" value="2"></el-option>
                            <el-option label="‰ΩìËÇ≤Á´ûÊäÄ" value="3"></el-option>
                            <el-option label="Ê£ãÁâå‰∏≠ÂøÉ" value="4"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="‰∏äÁ∫øÂπ≥Âè∞" :label-width="formLabelWidth">
                        <el-select v-model="updataGame.platform" placeholder="ËØ∑ÈÄâÊã©Ê¥ªÂä®Âå∫Âüü">
                            <el-option label="ÂÆâÂçì" value="android"></el-option>
                            <el-option label="IOS" value="ios"></el-option>
                            <el-option label="all" value="all"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="Êé®ËçêÁ±ªÂûã" :label-width="formLabelWidth">
                        <el-select v-model="updataGame.rank" placeholder="ËØ∑ÈÄâÊã©Ê¥ªÂä®Âå∫Âüü">
                            <el-option label="È¶ñÈ°µÊé®Ëçê" value="0"></el-option>
                            <el-option label="Á≤æÈÄâ" value="1"></el-option>
                            <el-option label="ÊúÄÊñ∞" value="2"></el-option>
                            <el-option label="ÊôÆÈÄö" value="3"></el-option>
                        </el-select>
                    </el-form-item>
                </el-form>
                <div slot="footer" class="dialog-footer">
                    <el-button @click="updateDialog = false">Âèñ Ê∂à</el-button>
                    <el-button type="primary" @click="editGame">Á°Æ ÂÆö</el-button>
                </div>
            </el-dialog>
        </el-main>
    </el-container>
</div>

<script type="text/javascript">
    var userListObject2 = {
        data() {
            return {
                formLabelWidth: "120px",
                gameList: [],// ÊâÄÊúâÁöÑÊ∏∏ÊàèÂàóË°®
                // total: 0, //ÊÄªÊù°Êï∞
                // currentpage: 1, // ÂΩìÂâçÈ°µ
                // pageSize: 3, //ÊØèÈ°µÊòæÁ§∫Âá†Êù°Êï∞ÊçÆ,

                pageInfo: { // ÂàÜÈ°µ‰ø°ÊÅØ
                    total: 0, //ÊÄªÊù°Êï∞
                    pageSize: 3, // ÊØèÈ°µÊòæÁ§∫Âá†Êù°Êï∞ÊçÆ
                    currentpage: 1 // ÂΩìÂâçÈ°µ
                },

                selectParams: { //Êü•ËØ¢Êó∂Êèê‰∫§Âà∞servletÁöÑÊï∞ÊçÆ
                    type: "showGameByPage",
                    nowPage: "1", // ÂΩìÂâçÈ°µ
                    pageNum: "3", // ÊØèÈ°µÊòæÁ§∫Âá†Êù°Êï∞ÊçÆ
                    gname: "" //  Ê∏∏ÊàèÂêçÁß∞
                },

                paramGame: {//  Êü•ËØ¢Êù°‰ª∂
                    gameName: ""
                },
                addDialog: false, // Ê∑ªÂä†Ê®°ÊÄÅÊ°ÜÁöÑÁä∂ÊÄÅÂÄº
                addGame: { // Ê∑ªÂä†Ê∏∏ÊàèÊó∂ÔºåÈúÄË¶ÅÊèê‰∫§Âà∞ÊúçÂä°Âô®ÁöÑÊï∞ÊçÆ
                    type: "addGame", // servlet‰∏≠Ë∞ÉÁî®ÊñπÊ≥ï
                    name: "",
                    title: "",
                    size: "",
                    state: "",
                    typeId: "",
                    platform: "",
                    rank: ""
                },

                updateDialog: false,
                updataGame: { // ‰øÆÊîπÊ∏∏ÊàèÊó∂ÔºåÈúÄË¶ÅÊèê‰∫§Âà∞ÊúçÂä°Âô®ÁöÑÊï∞ÊçÆ
                    type: "updataGame", // servlet‰∏≠Ë∞ÉÁî®ÊñπÊ≥ï
                    name: "",
                    title: "",
                    size: "",
                    state: "",
                    typeId: "",
                    platform: "",
                    rank: "",
                    gid: ""
                }
            }
        },
        methods: {
            currentChange(nowPage) {
                this.selectParams.nowPage = nowPage;
                this.queryGame(this.selectParams);
            },
            sizeChange(count) {
                this.selectParams.pageNum = count;
                this.queryGame(this.selectParams);
            },
            saveGame() {
                var vm = this;
                var addParams = this.addGame;
                // console.log("awdeasda"+addParams);
                // Â∞ÜÊï∞ÊçÆÊèê‰∫§Âà∞ÊúçÂä°Âô®
                axios({
                    method: 'post',
                    url: '/game.do',
                    params: addParams
                }).then(function (response) {
                    alert(response.data);
                    if (response.data == response.data) {
                        vm.addDialog = false; // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
                        vm.queryGame(vm.selectParams);
                    }
                }).catch(function (error) {
                    console.log(error);
                });
            },

            modifyGame(index) {
                ///Â∞ÜË¶Å‰øÆÊîπÁöÑÊ∏∏Êàè‰ø°ÊÅØÊ∑ªÂä†Âà∞Ê®°ÊÄÅÊ°Ü‰∏≠
                var game = this.gameList[index];
                this.updataGame = {
                    type: "updataGame", // servlet‰∏≠Ë∞ÉÁî®ÊñπÊ≥ï
                    name: game.name,
                    title: game.title,
                    size: game.size,
                    state: game.state,
                    typeName: game.typeName,
                    typeId: game.typeId,
                    platform: game.platform + "",
                    rank: game.rank,
                    gid: game.gid
                };
                console.log(game.typeid)
                console.log(game.name)

                // console.log(typeof (this.updataGame.platform));
                this.updateDialog = true; //ÊòæÁ§∫‰øÆÊîπÁöÑÊ®°ÊÄÅÊ°Ü
            },

            editGame() {
                //Â∞ÜÊ®°ÊÄÅÊ°Ü‰∏≠ÁöÑ‰øÆÊîπÊï∞ÊçÆ Êèê‰∫§Âà∞Êï∞ÊçÆÂ∫ì‰∏≠
                var vm = this;
                var editGame = this.updataGame;
                //Â∞ÜÊï∞ÊçÆÊèê‰∫§Âà∞Êï∞ÊçÆÂ∫ì
                axios({
                    method: 'post', // Êèê‰∫§ÊñπÂºè
                    url: '/game.do',// Êèê‰∫§Âú∞ÂùÄ
                    params: editGame
                }).then(function (response) {
                    alert(response.data);
                    if (response.data == response.data) {
                        vm.updateDialog = false; // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
                        // Êü•ËØ¢Ê∏∏ÊàèÂàóË°®
                        vm.queryGame(vm.selectParams);
                    }
                }).catch(function (error) {
                    console.log(error);
                });
            },
            deleteGame(gid) {
                var vm = this;
                axios({
                    method: 'post', // Êèê‰∫§ÊñπÂºè
                    url: '/game.do',// Êèê‰∫§Âú∞ÂùÄ
                    params: { //Êèê‰∫§ÁöÑÊï∞ÊçÆ
                        type: "deleteGame",
                        gid: gid
                    }
                }).then(function (response) {
                    console.log(response);
                    vm.queryGame(vm.selectParams);
                })
            },
            queryGame(params) {
                if (params == null) {
                    this.$data.selectParams.nowPage = 1;
                    params = this.$data.selectParams;
                }
                console.log(params)
                var vm = this;
                axios({
                    method: "post",
                    url: "/game.do",
                    params: params
                }).then(function (response) {
                    console.log("GameServletËøîÂõûÁöÑÊï∞ÊçÆ:!!!" + response.data);
                    var json = eval(response.data);
                    // Â∞Üserlvet‰∏≠Êü•ËØ¢Âà∞ÁöÑgameÊï∞ÊçÆËµãÂÄº:gameList„ÄÅpageInfo
                    vm.gameList = json.list;
                    vm.pageInfo = {
                        total: json.allCount, //ÊÄªÊù°Êï∞
                        pageSize: json.count, // ÊØèÈ°µÊòæÁ§∫Âá†Êù°Êï∞ÊçÆ
                        page: json.page // ÂΩìÂâçÈ°µ
                    };
                }).catch(function (error) {
                    console.log(error);
                });
            }
        },
        mounted: function () {
            //Êü•ËØ¢Ê∏∏ÊàèÂàóË°®‰∏≠ÁöÑÊï∞ÊçÆ
            this.queryGame(this.selectParams);
        }

        // var vm = this;
        // //ÂèëÈÄÅpostËØ∑Ê±Ç
        // axios({
        //     method: 'post', // Êèê‰∫§ÊñπÂºè
        //     url: '/game.do',// Êèê‰∫§Âú∞ÂùÄ
        //     params: {
        //         type: "showGameByPage"
        //     }
        // }).then(function (response) {
        //     // console.log(response.data.allCount);
        //     // console.log(response.data);
        //     vm.$data.gameList = response.data.list;
        //     vm.$data.currentpage = response.data.page;
        //     vm.$data.pageSize = response.data.count;
        //     vm.$data.total = response.data.allCount;
        // });

    };

    var vueObject2 = Vue.extend(userListObject2);
    new vueObject2().$mount("#vue2");
</script>
</body>
</html>
